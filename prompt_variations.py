import random

class PromptGenerator:
    """Класс для генерации вариативных промптов для избежания повторов"""
    
    def __init__(self):
        self.prompts = {
            "завтрак": [
                """Предложи простое блюдо для завтрака. Отвечай только названием (максимум 4-5 слов).
{avoid_text}
Пример: "Овсянка с ягодами" """,

                """Что приготовить Тане на завтрак? Ответь только названием блюда (до 5 слов).
{avoid_text}
Пример: "Творожные сырники" """,

                """Идея для завтрака? Только название простого блюда (максимум 5 слов).
{avoid_text}
Пример: "Яичница с зеленью" """
            ],
            
            "обед": [
                """Предложи простое блюдо для обеда. Отвечай только названием (максимум 4-5 слов).
{avoid_text}
Пример: "Куриный суп с лапшой" """,

                """Что приготовить Тане на обед? Ответь только названием блюда (до 5 слов).
{avoid_text}
Пример: "Рис с овощами" """,

                """Идея для обеда? Только название простого блюда (максимум 5 слов).
{avoid_text}
Пример: "Макароны с фаршем" """
            ],
            
            "ужин": [
                """Предложи простое блюдо для ужина. Отвечай только названием (максимум 4-5 слов).
{avoid_text}
Пример: "Запеченная рыба с картофелем" """,

                """Что приготовить Тане на ужин? Ответь только названием блюда (до 5 слов).
{avoid_text}
Пример: "Салат с курицей" """,

                """Идея для ужина? Только название простого блюда (максимум 5 слов).
{avoid_text}
Пример: "Котлеты с пюре" """
            ]
        }
    
    def get_random_prompt(self, meal_type, avoid_text=""):
        """Получить случайный промпт для категории еды"""
        print(f"[PROMPT DEBUG] Генерируем промпт для: {meal_type}")
        print(f"[PROMPT DEBUG] Избегаем: '{avoid_text}'")
        
        if meal_type not in self.prompts:
            print(f"[PROMPT WARNING] Неизвестная категория '{meal_type}', используем 'обед'")
            meal_type = "обед"  # fallback
        
        prompt_template = random.choice(self.prompts[meal_type])
        final_prompt = prompt_template.format(avoid_text=avoid_text)
        print(f"[PROMPT DEBUG] Выбранный шаблон (первые 50 символов): {prompt_template[:50]}...")
        
        return final_prompt

# Глобальный экземпляр генератора
prompt_generator = PromptGenerator()