from openai import OpenAI
from config import OPENAI_API_KEY

client = OpenAI(api_key=OPENAI_API_KEY)

def get_random_dish(meal_type):
    """–ü–æ–ª—É—á–∏—Ç—å —Å–ª—É—á–∞–π–Ω–æ–µ –±–ª—é–¥–æ –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–∞, –æ–±–µ–¥–∞ –∏–ª–∏ —É–∂–∏–Ω–∞"""
    prompt = f"""
    –¢—ã - –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –¢–∞–Ω–∏. –¢–≤–æ—è –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ - –ø—Ä–µ–¥–ª–∞–≥–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –∏ –≤–∫—É—Å–Ω—ã–µ –±–ª—é–¥–∞ –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è.
    
    –ö–∞—Ç–µ–≥–æ—Ä–∏—è: {meal_type}
    
    –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
    - –ü—Ä–µ–¥–ª–æ–∂–∏ –¢–û–õ–¨–ö–û –û–î–ù–û –±–ª—é–¥–æ
    - –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –Ω–∞–∑–≤–∞–Ω–∏–µ–º –±–ª—é–¥–∞ (–º–∞–∫—Å–∏–º—É–º 4-5 —Å–ª–æ–≤)
    - –ë–ª—é–¥–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø—Ä–æ—Å—Ç—ã–º –¥–ª—è –¥–æ–º–∞—à–Ω–µ–≥–æ –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è
    - –£—á–∏—Ç—ã–≤–∞–π —Ä—É—Å—Å–∫—É—é/–µ–≤—Ä–æ–ø–µ–π—Å–∫—É—é –∫—É—Ö–Ω—é
    - –ù–∏–∫–∞–∫–∏—Ö –æ–±—ä—è—Å–Ω–µ–Ω–∏–π –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π
    
    –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞: "–û–º–ª–µ—Ç —Å –ø–æ–º–∏–¥–æ—Ä–∞–º–∏"
    """
    
    try:
        response = client.chat.completions.create(
            model="gpt-4o-mini",
            messages=[{"role": "user", "content": prompt}],
            max_tokens=50,
            temperature=0.8
        )
        return response.choices[0].message.content.strip()
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ OpenAI: {e}")
        return "–û–º–ª–µ—Ç —Å –æ–≤–æ—â–∞–º–∏"  # fallback –≤–∞—Ä–∏–∞–Ω—Ç

def generate_weekly_menu():
    """–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é"""
    days = ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫", "–í—Ç–æ—Ä–Ω–∏–∫", "–°—Ä–µ–¥–∞", "–ß–µ—Ç–≤–µ—Ä–≥", "–ü—è—Ç–Ω–∏—Ü–∞", "–°—É–±–±–æ—Ç–∞", "–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"]
    menu = {}
    
    for day in days:
        menu[day] = {
            "–∑–∞–≤—Ç—Ä–∞–∫": get_random_dish("–∑–∞–≤—Ç—Ä–∞–∫"),
            "–æ–±–µ–¥": get_random_dish("–æ–±–µ–¥"), 
            "—É–∂–∏–Ω": get_random_dish("—É–∂–∏–Ω")
        }
    
    return menu

def format_weekly_menu(menu):
    """–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ–Ω—é –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ —Ç–µ–ª–µ–≥—Ä–∞–º"""
    text = "üçΩÔ∏è *–ú–µ–Ω—é –Ω–∞ –Ω–µ–¥–µ–ª—é:*\n\n"
    
    for day, meals in menu.items():
        text += f"*{day}:*\n"
        text += f"üåÖ –ó–∞–≤—Ç—Ä–∞–∫: {meals['–∑–∞–≤—Ç—Ä–∞–∫']}\n"
        text += f"‚òÄÔ∏è –û–±–µ–¥: {meals['–æ–±–µ–¥']}\n"
        text += f"üåô –£–∂–∏–Ω: {meals['—É–∂–∏–Ω']}\n\n"
    
    return text